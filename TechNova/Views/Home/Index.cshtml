@using TechNova.Models
@{
    ViewData["Title"] = "Home";
    var flashSales = ViewBag.FlashSales as List<Product>;
    var bestSellers = ViewBag.BestSellers as List<Product>;
    var explore = ViewBag.Explore as List<Product>;
    var newArrivals = ViewBag.NewArrivals as List<Product>;
}

<div class="home-page">
    <div class="container-fluid px-0 mt-4">
        <div class="d-flex justify-content-between align-items-center bg-black text-white px-5" style="height: 400px;">
            <div class="hero-text ps-4">
                <div class="d-flex align-items-center mb-3">
                    <i class="fa-brands fa-apple text-white fs-1"></i>
                    <p class="mb-0 ms-3">iPhone 14 Series</p>
                </div>
                <h1 class="fw-bold display-5">Up to 10%<br />off Voucher</h1>
                <a href="@Url.Action("Index","Products")" class="btn text-white fw-bold mt-3 d-inline-flex align-items-center" style="border-bottom: 1px solid white;">
                    Shop Now <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>

            <div class="hero-img">
                <img src="~/images/iphone-banner-right.png" alt="iPhone" class="img-fluid" style="max-height: 350px;" />
            </div>
        </div>
    </div>

    <div class="container mt-5 product-card-container">
        <h5 class="text-danger fw-bold">Today's</h5>
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="fw-bold">Flash Sales</h3>
            <div id="countdown" class="countdown-text"></div>
        </div>

        <div class="row">
            @if (flashSales != null)
            {
                foreach (var product in flashSales)
                {
                    <div class="col-md-3 mb-4">
                        <div class="card h-100">
                            <div class="image-div">
                                @if (product.DiscountPercent.HasValue && product.DiscountPercent.Value > 0)
                                {
                                    <span class="badge-discount">
                                        -@Math.Round(product.DiscountPercent.Value, 0)%
                                    </span>
                                }
                                <a href="@Url.Action("Details", "Products", new { id = product.ProductID })">
                                    <img src="@product.ImageURL" class="image-style" alt="@product.Name" />
                                </a>

                                <div class="card-actions">
                                    <button type="button" class="icon-btn mb-1" title="Add to Wishlist" aria-label="Add to Wishlist"
                                            data-product-id="@product.ProductID">
                                        <i class="far fa-heart"></i>
                                    </button>
                                    <a class="icon-btn" title="Quick View" aria-label="Quick View"
                                       href="@Url.Action("Details", "Products", new { id = product.ProductID })">
                                        <i class="far fa-eye"></i>
                                    </a>
                                </div>

                                <div class="add-to-cart-overlay">
                                    <form asp-controller="Cart" asp-action="Add" method="post" class="w-100 d-flex js-addtocart">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="productId" value="@product.ProductID" />
                                        <input type="hidden" name="qty" value="1" />
                                        <button type="submit" class="add-to-cart-btn w-100">Add To Cart</button>
                                    </form>
                                </div>
                            </div>

                            <a href="@Url.Action("Details", "Products", new { id = product.ProductID })" class="text-decoration-none text-dark">
                                <div class="card-body">
                                    <h6 class="card-title">@product.Name</h6>
                                    <div class="d-flex align-items-center mb-0">
                                        @if (product.DiscountPercent.HasValue && product.DiscountPercent.Value > 0 && product.DiscountedPrice.HasValue)
                                        {
                                            <p class="text-danger fw-bold mb-0">
                                                @product.DiscountedPrice.GetValueOrDefault().ToString("C")
                                            </p>
                                            <p class="text-decoration-line-through text-muted fw-bold ms-2 mb-0">
                                                @product.Price.ToString("C")
                                            </p>
                                        }
                                        else
                                        {
                                            <p class="text-danger fw-bold mb-0">
                                                @product.Price.ToString("C")
                                            </p>
                                        }
                                    </div>

                                    <div class="rating mb-1">
                                        @for (var i = 1; i <= 5; i++)
                                        {
                                            if (i <= Math.Floor(product.AvgRating))
                                            {
                                                <i class="fas fa-star text-warning"></i>
                                            }
                                            else if (i - product.AvgRating <= 0.5m) 
                                            {
                                                <i class="fas fa-star-half-alt text-warning"></i> 
                                            }
                                            else
                                            {
                                                <i class="far fa-star text-warning"></i>
                                            }
                                        }
                                        <small class="text-muted fw-bold ms-1">(@product.ReviewCount reviews)</small>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                }
            }
        </div>

        <div class="text-center mt-3">
            <a href="@Url.Action("All", "Products")" class="btn button-style">View All Products</a>
        </div>
    </div>

    <div class="container mt-5 product-card-container">
        <div class="d-flex justify-content-between mb-3">
            <h4 class="fw-bold">Best Selling Products</h4>
            <a href="#" class="btn button-outline-secondary btn-sm">View All</a>
        </div>
        <div class="row">
            @foreach (var product in bestSellers)
            {
                <div class="col-md-3 mb-4">
                    <div class="card h-100">
                        <div class="image-div">
                            @if (product.DiscountPercent.HasValue && product.DiscountPercent.Value > 0)
                            {
                                <span class="badge-discount">
                                    -@Math.Round(product.DiscountPercent.Value, 0)%
                                </span>
                            }

                            <a href="@Url.Action("Details", "Products", new { id = product.ProductID })">
                                <img src="@product.ImageURL" class="image-style" alt="@product.Name" />
                            </a>

                            <div class="card-actions">
                                <button type="button" class="icon-btn mb-1" title="Add to Wishlist" aria-label="Add to Wishlist"
                                        data-product-id="@product.ProductID">
                                    <i class="far fa-heart"></i>
                                </button>
                                <a class="icon-btn" title="Quick View" aria-label="Quick View"
                                   href="@Url.Action("Details", "Products", new { id = product.ProductID })">
                                    <i class="far fa-eye"></i>
                                </a>
                            </div>

                            <div class="add-to-cart-overlay">
                                <form asp-controller="Cart" asp-action="Add" method="post" class="w-100 d-flex js-addtocart">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="productId" value="@product.ProductID" />
                                    <input type="hidden" name="qty" value="1" />
                                    <button type="submit" class="add-to-cart-btn w-100">Add To Cart</button>
                                </form>
                            </div>
                        </div>

                        <a href="@Url.Action("Details", "Products", new { id = product.ProductID })" class="text-decoration-none text-dark">
                            <div class="card-body">
                                <h6 class="card-title">@product.Name</h6>
                                <div class="d-flex align-items-center mb-0">
                                    @if (product.DiscountPercent.HasValue && product.DiscountPercent.Value > 0 && product.DiscountedPrice.HasValue)
                                    {
                                        <p class="text-danger fw-bold mb-0">
                                            @product.DiscountedPrice.GetValueOrDefault().ToString("C")
                                        </p>
                                        <p class="text-decoration-line-through text-muted fw-bold ms-2 mb-0">
                                            @product.Price.ToString("C")
                                        </p>
                                    }
                                    else
                                    {
                                        <p class="text-danger fw-bold mb-0">
                                            @product.Price.ToString("C")
                                        </p>
                                    }
                                </div>
                                <div class="rating mb-1">
                                    @for (var i = 1; i <= 5; i++)
                                    {
                                        if (i <= Math.Floor(product.AvgRating))
                                        {
                                            <i class="fas fa-star text-warning"></i>
                                        }
                                        else if (i - product.AvgRating <= 0.5m)
                                        {
                                            <i class="fas fa-star-half-alt text-warning"></i>
                                        }
                                        else
                                        {
                                            <i class="far fa-star text-warning"></i>
                                        }
                                    }
                                    <small class="text-muted fw-bold ms-1">(@product.ReviewCount reviews)</small>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            }
        </div>
    </div>

    <section class="music-banner text-white">
        <div class="container">
            <div class="row align-items-center ps-5">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h6 class="text-danger fw-semibold mb-3">Categories</h6>
                    <h1 class="fw-bold display-5">Enhance Your<br>Music Experience</h1>
                    <a href="@Url.Action("Index","Products")" class="btn button-style text-white mt-4 px-4 py-2 fw-semibold">Buy Now!</a>
                </div>

                <div class="col-lg-6 text-center">
                    <img src="/images/speaker-banner.png" alt="JBL Speaker" class="img-fluid banner-image" />
                </div>
            </div>
        </div>
    </section>

    <div class="container mt-5 product-card-container">
        <h4 class="fw-bold mb-3">Explore Our Products</h4>
        <div class="row">
            @foreach (var product in explore)
            {
                <div class="col-md-3 mb-4">
                    <div class="card h-100">
                        <div class="image-div">
                            @if (product.DiscountPercent.HasValue && product.DiscountPercent.Value > 0)
                            {
                                <span class="badge-discount">
                                    -@Math.Round(product.DiscountPercent.Value, 0)%
                                </span>
                            }

                            <a href="@Url.Action("Details", "Products", new { id = product.ProductID })">
                                <img src="@product.ImageURL" class="image-style" alt="@product.Name" />
                            </a>

                            <div class="card-actions">
                                <button type="button" class="icon-btn mb-1" title="Add to Wishlist" aria-label="Add to Wishlist"
                                        data-product-id="@product.ProductID">
                                    <i class="far fa-heart"></i>
                                </button>
                                <a class="icon-btn" title="Quick View" aria-label="Quick View"
                                   href="@Url.Action("Details", "Products", new { id = product.ProductID })">
                                    <i class="far fa-eye"></i>
                                </a>
                            </div>

                            <div class="add-to-cart-overlay">
                                <form asp-controller="Cart" asp-action="Add" method="post" class="w-100 d-flex js-addtocart">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="productId" value="@product.ProductID" />
                                    <input type="hidden" name="qty" value="1" />
                                    <button type="submit" class="add-to-cart-btn w-100">Add To Cart</button>
                                </form>
                            </div>
                        </div>

                        <a href="@Url.Action("Details", "Products", new { id = product.ProductID })" class="text-decoration-none text-dark">
                            <div class="card-body">
                                <h6 class="card-title">@product.Name</h6>
                                <div class="d-flex align-items-center mb-0">
                                    @if (product.DiscountPercent.HasValue && product.DiscountPercent.Value > 0 && product.DiscountedPrice.HasValue)
                                    {
                                        <p class="text-danger fw-bold mb-0">
                                            @product.DiscountedPrice.GetValueOrDefault().ToString("C")
                                        </p>
                                        <p class="text-decoration-line-through text-muted fw-bold ms-2 mb-0">
                                            @product.Price.ToString("C")
                                        </p>
                                    }
                                    else
                                    {
                                        <p class="text-danger fw-bold mb-0">
                                            @product.Price.ToString("C")
                                        </p>
                                    }
                                </div>
                                <div class="rating mb-1">
                                    @for (var i = 1; i <= 5; i++)
                                    {
                                        if (i <= Math.Floor(product.AvgRating))
                                        {
                                            <i class="fas fa-star text-warning"></i>
                                        }
                                        else if (i - product.AvgRating <= 0.5m)
                                        {
                                            <i class="fas fa-star-half-alt text-warning"></i>
                                        }
                                        else
                                        {
                                            <i class="far fa-star text-warning"></i>
                                        }
                                    }
                                    <small class="text-muted fw-bold ms-1">(@product.ReviewCount reviews)</small>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            }
        </div>
    </div>

    <section class="container py-5">
        <div class="d-flex align-items-center mb-2">
            <i class="fas fa-square text-danger me-2 fs-4"></i>
            <h6 class="text-danger fw-bold mb-0">Featured</h6>
        </div>

        <h2 class="fw-bold mb-4">New Arrival</h2>

        <div class="row g-4">
            <div class="col-lg-6">
                <div class="featured-card tall" style="background-image: url('/images/ps5.png');">
                    <h3 class="fw-bold">PlayStation 5</h3>
                    <p class="mb-2">Black and White version of the PS5 coming out on sale.</p>
                    <a href="@Url.Action("Index","Products")">Shop Now</a>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="row g-4">
                    <div class="col-12">
                        <div class="featured-card" style="background-image: url('/images/women.png'); min-height: 300px;">
                            <h4 class="fw-bold">Women’s Collections</h4>
                            <p class="mb-2">Featured woman collections that give you another vibe.</p>
                            <a href="@Url.Action("Index","Products")">Shop Now</a>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="featured-card" style="background-image: url('/images/speakers.png'); min-height: 300px;">
                            <h5 class="fw-bold">Speakers</h5>
                            <p class="mb-2">Amazon wireless speakers</p>
                            <a href="@Url.Action("Index","Products")">Shop Now</a>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="featured-card" style="background-image: url('/images/perfume.png'); min-height: 300px;">
                            <h5 class="fw-bold">Perfume</h5>
                            <p class="mb-2">GUCCI INTENSE OUD EDP</p>
                            <a href="@Url.Action("Index","Products")" Shop Now</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container row text-center mt-1 mb-2 p-5 services">
        <div class="col-md-4">
            <div class="d-flex flex-column align-items-center">
                <div class="bg-dark rounded-circle d-flex justify-content-center align-items-center" style="width: 70px; height: 70px;">
                    <i class="fas fa-truck-fast fa-2x text-white"></i>
                </div>
                <h6 class="mt-3 fw-bold">FREE AND FAST DELIVERY</h6>
                <p class="text-muted">Free delivery for all orders over $140</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="d-flex flex-column align-items-center">
                <div class="bg-dark rounded-circle d-flex justify-content-center align-items-center" style="width: 70px; height: 70px;">
                    <i class="fas fa-headphones fa-2x text-white"></i>
                </div>
                <h6 class="mt-3 fw-bold">24/7 CUSTOMER SERVICE</h6>
                <p class="text-muted">Friendly 24/7 customer support</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="d-flex flex-column align-items-center">
                <div class="bg-dark rounded-circle d-flex justify-content-center align-items-center" style="width: 70px; height: 70px;">
                    <i class="fas fa-check-circle fa-2x text-white"></i>
                </div>
                <h6 class="mt-3 fw-bold">MONEY BACK GUARANTEE</h6>
                <p class="text-muted">We return money within 30 days</p>
            </div>
        </div>
    </div>

</div>
@section Scripts {
    <script>
        function startCountdown(hours) {
            const end = new Date();
            end.setHours(end.getHours() + hours);
            setInterval(() => {
                const now = new Date();
                const diff = end - now;
                if (diff < 0) return;
                const hrs = Math.floor(diff / 1000 / 60 / 60);
                const mins = Math.floor((diff / 1000 / 60) % 60);
                const secs = Math.floor((diff / 1000) % 60);
                document.getElementById("countdown").innerText = `Ends In: ${hrs}h ${mins}m ${secs}s`;
            }, 1000);
        }
        startCountdown(24);
    </script>
}
